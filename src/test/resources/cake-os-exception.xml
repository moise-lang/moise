<?xml version="1.0" encoding="UTF-8"?>

<?xml-stylesheet href="https://moise-lang.github.io/xml/os.xsl" type="text/xsl" ?>

<organisational-specification
    id="atm" os-version="1.0"

    xmlns="https://moise-lang.github.io/os"
    
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://moise-lang.github.io/os https://moise-lang.github.io/os.xsd">

    <structural-specification>

        <role-definitions>
            <role id="baker" />
            <role id="apprentice" />
            <role id="customer" />
            <role id="supplier" />
        </role-definitions>

        <group-specification id="bakery">
            <roles>
                <role id="baker" min="1" max="1" />
                <role id="apprentice" min="1" max="1" />
                <role id="supplier" min="1" max="1" />
                <role id="customer" min="1" max="1" />
            </roles>
        </group-specification>

    </structural-specification>

    <functional-specification>

        <scheme id="cake_sch">

            <goal id="haveCake">
                <plan operator="sequence">
                    <goal id="workspaceSetup">
                        <plan operator="parallel">
                            <goal id="provideIngredients" />
                            <goal id="switchOnOven" />
                        </plan>
                    </goal>
                    <goal id="mixIngredients" />
                    <goal id="bakeCake" />
                </plan>
            </goal>

            <notification-policy id="np1" target="provideIngredients" condition="scheme_id(S) &amp; failed(S,provideIngredients)">
                <report id="ingredientsUnavailable">
                    <argument id="missingIngredients" arity="1" />
                    <raise-goal id="notifyIngredientsUnavailability"/>
                    <handle-goal id="dealWithMissingIngredients" />
                </report>
            </notification-policy>

            <notification-policy id="np2" target="switchOnOven" condition="scheme_id(S) &amp; failed(S,switchOnOven)">
                <report id="ovenBroken">
                    <argument id="faultType" arity="1" />
                    <raise-goal id="notifyProblemWithOven" />
                    <handle-goal id="checkOven" />
                </report>
            </notification-policy>

            <notification-policy id="np2" target="workspaceSetup" condition="scheme_id(S) &amp; (failed(S,dealWithMissingIngredients) | failed(S,checkOven))">
                <report id="cakePreparationFailure">
                    <raise-goal id="notifyCakePreparationFailure" />
                    <handle-goal id="cancelOrder" />
                </report>
            </notification-policy>

            <mission id="mApprentice" min="1" max="1">
                <goal id="switchOnOven" />
                <goal id="bakeCake" />
                <goal id="notifyProblemWithOven" />
            </mission>
            <mission id="mSupplier" min="1" max="1">
                <goal id="provideIngredients" />
                <goal id="notifyIngredientsUnavailability" />
            </mission>
            <mission id="mBaker" min="1" max="1">
                <goal id="mixIngredients" />
                <goal id="dealWithMissingIngredients" />
                <goal id="checkOven" />
                <goal id="notifyCakePreparationFailure" />
            </mission>
            <mission id="mCustomer" min="1" max="1">
                <goal id="haveCake" />
                <goal id="cancelOrder" />
            </mission>

        </scheme>
    </functional-specification>

    <normative-specification>
        <norm id="n1" type="obligation" role="supplier"
            mission="mSupplier" />
        <norm id="n2" type="obligation" role="apprentice"
            mission="mApprentice" />
        <norm id="n3" type="obligation" role="baker" mission="mBaker" />
        <norm id="n4" type="obligation" role="customer" mission="mCustomer" />
    </normative-specification>

</organisational-specification>
